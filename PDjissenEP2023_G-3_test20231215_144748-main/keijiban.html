<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ツエーゲン金沢掲示板</title>
    <style>
        /* ここにスタイルを追加する */
        section {
            margin-top: 20px;
        }

        .post {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
        }

        .post span.name {
            font-weight: bold;
            color: #007bff; /* 任意の色を指定 */
        }

        .deleteButton {
            margin-top: 10px;
        }

        #timeRemaining {
            color: red; /* 残り時間を目立たせるための色 */
        }

        .post-image {
            max-width: 100%; /* 画像の最大幅を100%に設定 */
            max-height: 300px; /* 画像の最大高さを300pxに設定 */
        }
    </style>
</head>
<body>
    <h1>ツエーゲン金沢掲示板</h1>
    <section>
        <h2>新規投稿</h2>
        <form id="postForm">
            名前：<input type="text" name="name" id="name"><br>
            本文：<textarea name="section" id="content" rows="3" maxlength="400" oninput="updateCharacterCount()"></textarea><br>
            <!-- 残り文字数表示-->
            <span id="remainingCharacters">残り文字数： 400</span><br>
            画像：<input type="file" name="image" id="image"><br>
            <button type="button" onclick="addPost()" id="postButton">投稿する</button>
            <span id="timeRemaining"></span>
        </form>
    </section>
    <section>
        <h2>投稿一覧</h2>
        <div id="postList"></div>
    </section>

    <script>
        var postButton = document.getElementById("postButton");
        var timeRemainingSpan = document.getElementById("timeRemaining");
        var isButtonEnabled = true;
        var remainingTime = 0;
        var postCount = 0; // Add post count variable

        function enablePostButton() {
            isButtonEnabled = true;
            postButton.removeAttribute("disabled");
            timeRemainingSpan.innerText = "";
        }

        function disablePostButton() {
            isButtonEnabled = false;
            postButton.setAttribute("disabled", "disabled");
            remainingTime = 5;
            updateRemainingTime();
            var interval = setInterval(function () {
                remainingTime -= 1;
                updateRemainingTime();
                if (remainingTime <= 0) {
                    clearInterval(interval);
                    enablePostButton();
                }
            }, 1000);
        }

        function updateRemainingTime() {
            timeRemainingSpan.innerText = "次の投稿まで: " + remainingTime + "秒";
        }

        // 禁止ワードのリスト
        var forbiddenWords = ["禁止ワード1", "禁止ワード2", "禁止ワード3"];

        function containsForbiddenWord(text) {
            for (var i = 0; i < forbiddenWords.length; i++) {
                if (text.includes(forbiddenWords[i])) {
                    return true;
                }
            }
            return false;
        }

        function updateCharacterCount() {
            var content = document.getElementById("content").value;
            var remainingCharacters = 400 - content.length;
            document.getElementById("remainingCharacters").innerText = "残り文字数：" + remainingCharacters;
        }

        function addPost() {
            if (!isButtonEnabled) {
                alert("5秒間隔でしか投稿できません");
                return;
            }

            // フォームから入力値を取得
            var name = document.getElementById("name").value;
            var content = document.getElementById("content").value;
            var image = document.getElementById("image").files[0];

            // 入力がない場合は何もしない
            if (!name || !content) {
                alert("名前と本文を入力してください");
                return;
            }

            // 文字数制限の追加
            if (content.length > 400) {
                alert("本文は400文字までです");
                return;
            }

            // 残り文字数を表示
            var remainingCharacters = 400 - content.length;
            document.getElementById("remainingCharacters").innerText = "残り文字数：" + remainingCharacters;

            // 禁止ワードが含まれているかチェック
            if (containsForbiddenWord(name) || containsForbiddenWord(content)) {
                alert("禁止ワードが含まれています");
                return;
            }

            // 投稿を表示する要素を取得
            var postList = document.getElementById("postList");

            // 新しい投稿要素を作成
            var postElement = document.createElement("div");
            postElement.classList.add("post");

            // 名前を表示するための span 要素を作成
            var nameSpan = document.createElement("span");
            nameSpan.classList.add("name");
            nameSpan.innerText = name;

            // Get the current date and time
            var currentDate = new Date();
            var formattedMonth = ('0' + (currentDate.getMonth() + 1)).slice(-2);
            var formattedDay = ('0' + currentDate.getDate()).slice(-2);
            var formattedDate = currentDate.getFullYear() + '/' + formattedMonth + '/' + formattedDay;
            var formattedTime = currentDate.getHours() + ':' + ('0' + currentDate.getMinutes()).slice(-2);

            // Increment post count
            postCount++;

            // 投稿要素に名前と本文、日時、番号を追加
            postElement.innerHTML = "<span style='font-weight: bold;'>投稿番号: " + postCount + "</span><br>";
            postElement.appendChild(nameSpan);
            postElement.innerHTML += "<br>" + content + "<br>" + formattedDate + " " + formattedTime;

            // 画像を表示するための img 要素を作成
            var imageElement = document.createElement("img");
            imageElement.classList.add("post-image");

            if (image) {
                // 画像が選択されている場合、画像のURLを表示
                var imageURL = URL.createObjectURL(image);
                imageElement.src = imageURL;
            } else {
                // 画像が選択されていない場合は空の画像を表示
                imageElement.style.display = "none"; // 画像が非表示
            }
            postElement.appendChild(imageElement);

            // Add delete button
            var deleteButton = document.createElement("button");
            deleteButton.classList.add("deleteButton");
            deleteButton.innerText = "削除";
            deleteButton.onclick = function () {
                if (window.confirm("本当に削除しますか？")) {
                    postList.removeChild(postElement);
                }
            };
            postElement.appendChild(deleteButton);

            // 投稿一覧に追加
            postList.appendChild(postElement);

            // 新しい投稿が上に来るようにする
            postList.insertBefore(postElement, postList.firstChild);

            // フォームをクリア
            document.getElementById("postForm").reset();

            // ボタンを無効にする
            disablePostButton();
        }

        //画像プレビュー
        function previewImage() {
            var imagePreview = document.getElementById("imagePreview");
            var imageInput = document.getElementById("image");
            var image = imageInput.files[0];

            if (image) {
                var imageURL = URL.createObjectURL(image);
                imagePreview.src = imageURL;
                imagePreview.style.display = "block"; // プレビューを表示
            } else {
                imagePreview.style.display = "none"; // 画像が非表示
            }
        }
    </script>
</body>
</html>
